(window.webpackJsonpngbg=window.webpackJsonpngbg||[]).push([[0],{11:function(e,t,r){e.exports={root:"spriteEntry_root__21-Rc",hide:"spriteEntry_hide__1KLBL",index:"spriteEntry_index__3_j9A",focused:"spriteEntry_focused__2e2R9",spriteContainer:"spriteEntry_spriteContainer__3BESY",sprite:"spriteEntry_sprite__3D55Y"}},12:function(e,t,r){e.exports={root:"cropRect_root__LYSAR",mask:"cropRect_mask__Vl5ZD",crop:"cropRect_crop__2ev0N"}},14:function(e,t,r){e.exports={root:"layers_root__pN2-U",layer:"layers_layer__1JaOv",focused:"layers_focused__1aScK",group:"layers_group__2ZkQp"}},24:function(e,t,r){e.exports={root:"spriteTray_root__1Sixf",locked:"spriteTray_locked__Lvuwa",spriteEntries:"spriteTray_spriteEntries__16oai"}},28:function(e,t,r){e.exports={sprite:"sprite_sprite__38hI5",positioned:"sprite_positioned__16NC_"}},40:function(e,t,r){e.exports={root:"emulator_root__3kH7Z"}},41:function(e,t,r){e.exports={positioned:"tile_positioned__9EsHg"}},42:function(e,t,r){e.exports={root:"extractedTile_root__14wnu"}},43:function(e,t,r){e.exports={root:"extractedSprite_root__gpe6g"}},46:function(e,t,r){e.exports=r(69)},68:function(e,t,r){},69:function(e,t,r){"use strict";r.r(t);var n=r(0),a=r.n(n),o=r(16),i=r.n(o),c=r(26),u=r.n(c),s=r(13),l=r(7),p=r(44),f=r(2),d=r(4),m=r(3),y=r(45);function h(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}var v=128,g=65536,w=66560,b=67584;function O(e,t,r){for(var n=window.Module._get_tile_ram_addr(),a=v*e,o=[],i=0;i<4*t;++i)o[i]=window.HEAPU8[n+a+i];for(var c=[],u=0;u<o.length;u+=4){var s=o[u]|o[u+1]<<8,l=o[u+2]|o[u+3]<<8,p=s|(l>>4&15)<<16,f=0;8&l?f=3:4&l&&(f=2);var d=l>>8&255,m=!!(1&l),y=!!(2&l);c.push({y:r[u/4],tileIndex:p,paletteIndex:d,horizontalFlip:m,verticalFlip:y,autoAnimation:f})}return c}function E(e){if(e<0)throw new Error("getYSpriteSizeSticky: sprite index under zero!");var t=window.Module._get_tile_ram_addr()+w+2*e,r=window.HEAPU8[t]|window.HEAPU8[t+1]<<8,n=!!(r>>6&1);if(n)return function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?h(r,!0).forEach(function(t){Object(d.a)(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):h(r).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}({},E(e-1),{sticky:n});for(var a=63&r,o=function(e,t,r){var n,a=512-e;if(a>272&&(a-=512),2===(n=32===r?1:r>=33?2:0)||1===n&&255===t)for(;a<0;)a+=t+1<<1;return a}(r>>7,_(e,{ignoreSticky:!0}).yScale,a),i=[],c=0;c<a;++c)i.push((o+16*c)%512);return{y:o,tileYs:i,spriteSize:a,sticky:n}}function x(e){if(e<0)throw new Error("getX: sprite index under zero!");var t;if(E(e).sticky){var r=_(e).xScale;t=x(e-1)+r}else{var n=window.Module._get_tile_ram_addr()+b+2*e;t=(window.HEAPU8[n]|window.HEAPU8[n+1]<<8)>>7}return t>=496&&(t-=512),t}function _(e,t){if(e<0)throw new Error("getScale: sprite index under zero!");if((!t||!t.ignoreSticky)&&E(e).sticky)return _(e-1);var r=window.Module._get_tile_ram_addr()+g+2*e,n=window.HEAPU8[r]|window.HEAPU8[r+1]<<8;return{yScale:255&n,xScale:1+(n>>8&15)}}function j(e,t){var r=E(e),n=r.sticky,a=r.y,o=r.tileYs,i=r.spriteSize;return{tiles:O(e,t?i:32,o),x:x(e),sticky:n,y:a,spriteSize:i}}var I=16,M=2*I;function C(e){var t=e>>15&1;return[((e>>8&15)<<2|(e>>14&1)<<1|t)/63*255,((e>>4&15)<<2|(e>>13&1)<<1|t)/63*255,((15&e)<<2|(e>>12&1)<<1|t)/63*255,255]}function S(e){var t=(window.Module._get_current_pal_addr()+e*M)/2;return Object(m.a)(window.Module.HEAPU16.slice(t,t+I))}function k(e){var t=e.map(C);return[[0,0,0,0]].concat(Object(m.a)(t.slice(1)))}function P(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function F(e){var t=e.y,r=(e.paletteIndex,Object(y.a)(e,["y","paletteIndex"])),n=S(e.paletteIndex);return function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?P(r,!0).forEach(function(t){Object(d.a)(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):P(r).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}({},r,{composedY:t,neoGeoPalette:n,rgbPalette:k(n)})}function B(e,t,r){var n=function(e){for(var t=e,r=j(t,!0);r.sticky&&t>0;)r=j(t-=1,!0);var n=[];do{n.push(t),r=j(t+=1,!0)}while(r.sticky);return n}(e).map(function(e,r){var n=j(e,!0);return{spriteMemoryIndex:e,tiles:n.tiles.map(F),screenX:n.x,screenY:n.y,composedX:t+16*r,composedY:n.y}}),a={pauseId:r,sprites:n,hidden:!1};return n.forEach(function(e){return e.group=a}),a}var N=r(39);function D(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function A(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?D(r,!0).forEach(function(t){Object(d.a)(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):D(r).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}var z={hasStarted:!1,isPaused:!1,pauseId:0,layers:[],focusedLayerIndex:-1,crop:void 0};function T(e){var t=e.reduce(function(e,t){return e.concat(t.groups)},[]).reduce(function(e,t){var r=t.sprites.reduce(function(e,t){return e.concat(t.tiles)},[]);return e.concat(r)},[]),r=Math.min.apply(Math,Object(m.a)(t.map(function(e){return e.composedY})));if(r<0){var n=-1*r;t.forEach(function(e){return e.composedY+=n})}return e}function L(e,t){var r=e.reduce(function(e,t){return e.concat(t.sprites)},[]),n=function(e){var t=Math.max.apply(Math,Object(m.a)(e.map(function(e){return e.composedX})))+16;return e.map(function(e){return A({},e,{spriteMemoryIndex:e.spriteMemoryIndex,composedX:2*t-(e.composedX+16),tiles:e.tiles.map(function(e){return A({},e,{horizontalFlip:!e.horizontalFlip})})})}).reverse()}(r),a={pauseId:t,hidden:!1,sprites:function(e){var t=Math.min.apply(Math,Object(m.a)(e.map(function(e){return e.composedX}))),r=Math.max.apply(Math,Object(m.a)(e.map(function(e){return e.composedX})))+16,n=r-t;return e.map(function(e){return A({},e,{spriteMemoryIndex:e.spriteMemoryIndex,composedX:t-n+(r-(e.composedX+16)),tiles:e.tiles.map(function(e){return A({},e,{horizontalFlip:!e.horizontalFlip})})})}).reverse()}(r)},o={pauseId:t,hidden:!1,sprites:n};return a.sprites.forEach(function(e){return e.group=a}),o.sprites.forEach(function(e){return e.group=o}),[a,o]}function R(e,t){switch(t.type){case"StartEmulation":return A({},e,{hasStarted:!0});case"TogglePause":var r=!e.isPaused;return A({},e,{isPaused:r,pauseId:r?e.pauseId+1:e.pauseId});case"ExtractSprite":var n=t,a=n.spriteMemoryIndex,o=n.composedX,i=n.pauseId;if(i){var c=e.layers[e.focusedLayerIndex];if(!c)return e;var u=c.groups.find(function(e){return e.pauseId===i&&e.sprites.some(function(e){return e.spriteMemoryIndex===a})});return u?(function(e,t,r){var n=r-e.sprites[0].composedX;t.filter(function(t){return t.pauseId===e.pauseId}).forEach(function(e){e.sprites.forEach(function(e){e.composedX+=n})})}(u,c.groups,o),A({},e)):e}var s,l=B(a,o,e.pauseId),p=e.layers[e.focusedLayerIndex]||e.layers[e.layers.length-1]||{groups:[l],hidden:!1},f=p.groups.filter(function(e){return e.pauseId!==l.pauseId||!function(e,t){var r=e.sprites.map(function(e){return e.spriteMemoryIndex}).sort(),n=t.sprites.map(function(e){return e.spriteMemoryIndex}).sort();return Object(N.isEqual)(r,n)}(e,l)});return function(e,t){var r=t.find(function(t){return t.pauseId===e.pauseId});if(r){var n=r.sprites[0].composedX-r.sprites[0].screenX;e.sprites.forEach(function(e){return e.composedX=e.screenX+n})}}(l,f),s=0===e.layers.length?[p]:e.layers.map(function(e){return e===p?A({},p,{groups:[].concat(Object(m.a)(p.groups),[l])}):e}),A({},e,{layers:s,focusedLayerIndex:1===s.length?0:e.focusedLayerIndex});case"HandleNegatives":return A({},e,{layers:T(e.layers)});case"DeleteGroup":var d=t.group,y=e.layers.map(function(e){if(e.groups.indexOf(d)>-1){var t=e.groups.filter(function(e){return e!==d});return A({},e,{groups:t})}return e});return A({},e,{layers:y});case"ToggleVisibilityOfGroup":var h=t.group,v=e.layers.map(function(e){if(e.groups.indexOf(h)>-1){var t=e.groups.map(function(e){return e===h?A({},e,{hidden:!e.hidden}):e});return A({},e,{groups:t})}return e});return A({},e,{layers:v});case"NewLayer":return A({},e,{layers:e.layers.concat({groups:[],hidden:!1,extendedViaMirror:!1}),focusedLayerIndex:e.layers.length});case"DeleteLayer":var g=t.layer;return A({},e,{layers:e.layers.filter(function(e){return e!==g}),focusedLayerIndex:-1});case"ToggleVisibilityOfLayer":var w=t.layer,b=e.layers.map(function(e){return e===w?A({},e,{hidden:!e.hidden}):e});return A({},e,{layers:b});case"SetFocusedLayer":var O=t.layer;return A({},e,{focusedLayerIndex:e.layers.indexOf(O)});case"SetCrop":return A({},e,{crop:t.crop});case"ClearCrop":return A({},e,{crop:void 0});case"ExtendLayerViaMirror":var E=L(t.layer.groups,e.pauseId),x=e.layers.concat({groups:E,hidden:!1,extendedViaMirror:!1});return A({},e,{layers:x=function(e){var t=e.reduce(function(e,t){return e.concat(t.groups)},[]).reduce(function(e,t){return e.concat(t.sprites)},[]),r=Math.min.apply(Math,Object(m.a)(t.map(function(e){return e.composedX})));if(r<0){var n=-1*r;t.forEach(function(e){return e.composedX+=n})}return e}(x)})}return function(e){throw new Error("Non exhaustive switch statement")}(t.type)}var X=Object(n.createContext)(z),U=Object(n.createContext)(function(){return 0}),Y=function(e){var t=e.children,r=Object(n.useReducer)(R,z),o=Object(f.a)(r,2),i=o[0],c=o[1];return a.a.createElement(U.Provider,{value:c},a.a.createElement(X.Provider,{value:i},t))};function H(){return[Object(n.useContext)(X),Object(n.useContext)(U)]}var V={type:"TogglePause"},G={type:"StartEmulation"};var Z={type:"HandleNegatives"};var q={type:"NewLayer"};var Q={type:"ClearCrop"};var W=r(10),K=r.n(W),J=r(23),$=r(5),ee=r.n($),te=r(40),re=r.n(te);function ne(e){return new Promise(function(t,r){var n=new FileReader;n.addEventListener("load",function(){n.result?t(n.result):r("Failed to load: ".concat(e.name))}),n.readAsArrayBuffer(e)})}function ae(e){return oe.apply(this,arguments)}function oe(){return(oe=Object(J.a)(K.a.mark(function e(t){var r;return K.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,ne(t);case 2:r=e.sent,window.Module.FS_createDataFile("/virtualfs",t.name,new Uint8Array(r),!0,!0);case 4:case"end":return e.stop()}},e)}))).apply(this,arguments)}var ie=function(e){var t=H(),r=Object(f.a)(t,2),o=r[0],i=r[1],c=Object(n.useState)(""),u=Object(f.a)(c,2),s=u[0];u[1];function l(){return(l=Object(J.a)(K.a.mark(function e(t){var r;return K.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.target&&t.target.files&&t.target.files[0]){e.next=3;break}return e.abrupt("return");case 3:return e.next=5,ae(r);case 5:case"end":return e.stop()}},e)}))).apply(this,arguments)}function p(){return(p=Object(J.a)(K.a.mark(function e(t){var r;return K.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.target&&t.target.files&&t.target.files[0]){e.next=3;break}return e.abrupt("return");case 3:return e.next=5,ae(r);case 5:d(r.name.replace(".zip",""));case 7:case"end":return e.stop()}},e)}))).apply(this,arguments)}function d(e){var t=window.stackAlloc(12);window.HEAP32[t>>2]=window.allocateUTF8OnStack("gngeo"),window.HEAP32[1+(t>>2)]=window.allocateUTF8OnStack(e||s),window.HEAP32[2+(t>>2)]=0,i(G);try{window.Module._run_rom(2,t)}catch(r){console.log("_run_rom threw")}}var m=ee()(re.a.root,e.className);return a.a.createElement("div",{className:m},a.a.createElement("canvas",{id:"canvas"}),a.a.createElement("div",null,"BIOS",a.a.createElement("input",{type:"file",onChange:function(e){return l.apply(this,arguments)}})),a.a.createElement("div",null,"ROM",a.a.createElement("input",{type:"file",onChange:function(e){return p.apply(this,arguments)}})),null,a.a.createElement("button",{disabled:!o.hasStarted,onClick:function(){o.isPaused?window.Module.resumeMainLoop():window.Module.pauseMainLoop(),i(V)}},o.isPaused?"resume":"pause"))},ce=r(18),ue=r(19),se=r(21),le=r(20),pe=r(22),fe=128,de={0:3,1:2,2:1,3:0,4:7,5:6,6:5,7:4};function me(e,t,r){for(var n=window.Module._get_rom_ctile_addr(),a=fe*t,o=[],i=0;i<fe;++i)o[i]=window.HEAPU8[n+a+i];e.width=16,e.height=16;for(var c=e.getContext("2d"),u=c.getImageData(0,0,16,16),s=0;s<16;++s)for(var l=0;l<8;++l)for(var p=o[8*s+de[l]],f=15&p,d=r[p>>4&15],m=r[f],y=0;y<d.length;++y)u.data[4*(16*s+2*l)+y]=d[y],u.data[4*(16*s+2*l+1)+y]=m[y];c.putImageData(u,0,0)}var ye=r(41),he=r.n(ye),ve=function(e){function t(){return Object(ce.a)(this,t),Object(se.a)(this,Object(le.a)(t).apply(this,arguments))}return Object(pe.a)(t,e),Object(ue.a)(t,[{key:"render",value:function(){var e=this.props,t=e.y,r=e.tileIndex,n=e.paletteIndex,o=e.horizontalFlip,i=e.verticalFlip,c=e.positioned;var u=i?-1:1,s={transform:"scale(".concat(o?-1:1,",").concat(u,")"),top:t},l=ee()(Object(d.a)({},he.a.positioned,c));return a.a.createElement("canvas",{className:l,ref:function(e){return e&&function(e){var t=k(S(n));me(e,r,t)}(e)},style:s})}}]),t}(a.a.PureComponent),ge=r(28),we=r.n(ge),be=function(e){var t=e.className,r=e.spriteIndex,n=e.positioned,o=e.overrideX,i=e.honorTileSize,c=Object(l.c)({item:{spriteIndex:r,type:"Sprite"}}),u=Object(f.a)(c,2),s=(u[0],u[1]),p=j(r,i);if(0===p.tiles.length)return null;var m=p.tiles.map(function(e,t){return a.a.createElement(ve,{key:t,positioned:n,y:e.y-p.y,tileIndex:e.tileIndex,paletteIndex:e.paletteIndex,horizontalFlip:e.horizontalFlip,verticalFlip:e.verticalFlip})}),y={top:p.y,left:"number"===typeof o?o:p.x,gridTemplateRows:"repeat(".concat(p.tiles.length,", 16px)"),zIndex:r},h=ee()(we.a.sprite,t,Object(d.a)({},we.a.positioned,n));return a.a.createElement("div",{ref:s,className:h,style:y},m)},Oe=r(11),Ee=r.n(Oe),xe=function(e){var t,r=e.className,n=e.spriteIndex,o=e.render,i=e.hideIfEmpty,c=e.focused,u=e.honorTileSize,s=e.onClick,l=ee()(Ee.a.root,r,(t={},Object(d.a)(t,Ee.a.hide,o&&i&&function(e){return 0===E(e).spriteSize}(n)),Object(d.a)(t,Ee.a.focused,c),t));return a.a.createElement("div",{className:l,onClick:s},a.a.createElement("div",{className:Ee.a.index},n),a.a.createElement("div",{className:Ee.a.spriteContainer},o&&a.a.createElement(be,{className:Ee.a.sprite,spriteIndex:n,positioned:!1,honorTileSize:u})))},_e=r(24),je=r.n(_e);var Ie=function(e){var t=e.className,r=H(),o=Object(f.a)(r,1)[0],i=Object(n.useState)([]),c=Object(f.a)(i,2),u=c[0],s=c[1],l=Object(n.useState)(null),p=Object(f.a)(l,2),m=p[0],y=p[1],h=ee()(je.a.root,t,Object(d.a)({},je.a.locked,!o.isPaused));return a.a.createElement("div",{className:h},a.a.createElement("div",{key:o.pauseId,className:je.a.spriteEntries,style:{gridTemplateColumns:"repeat(".concat(381,", max-content)")}},new Array(381).fill(1,0,381).map(function(e,t){return a.a.createElement(xe,{key:t,spriteIndex:t,render:o.isPaused,hideIfEmpty:!0,onClick:function(e){if(e.ctrlKey)s(u.concat(t)),y(null);else if(e.shiftKey)if(null!==m||1===u.length){var r=Math.min(m||u[0],t),n=Math.max(m||u[0],t);s(function(e,t){var r=t-e+1;return new Array(r).fill(0,0,r).map(function(t,r){return r+e})}(r,n))}else s([t]),y(t);else s([t]),y(null)},focused:u.indexOf(t)>-1,honorTileSize:!0})})))},Me=r(42),Ce=r.n(Me),Se=function(e){function t(){return Object(ce.a)(this,t),Object(se.a)(this,Object(le.a)(t).apply(this,arguments))}return Object(pe.a)(t,e),Object(ue.a)(t,[{key:"render",value:function(){var e=this.props,t=e.y,r=e.tileIndex,n=e.rgbPalette,o=e.horizontalFlip;var i=e.verticalFlip?-1:1,c={transform:"scale(".concat(o?-1:1,",").concat(i,")"),top:t};return a.a.createElement("canvas",{className:Ce.a.root,ref:function(e){return e&&void me(e,r,n)},style:c})}}]),t}(a.a.PureComponent),ke=r(43),Pe=r.n(ke),Fe=function(e){var t=e.data,r=e.autoAnimate,n=e.animationCounter,o=e.canDrag,i=Object(l.c)({item:{spriteIndex:t.spriteMemoryIndex,pauseId:t.group.pauseId,type:"Sprite"},canDrag:function(){return o}}),c=Object(f.a)(i,2),u=(c[0],c[1]),s=t.tiles.map(function(e,o){var i=e.tileIndex;return r&&"number"===typeof n&&(3===e.autoAnimation&&(i=(-8&i)+(i+n&7)),2===e.autoAnimation&&(i=(-4&i)+(i+n&3))),a.a.createElement(Se,{key:o,y:e.composedY-t.composedY,tileIndex:i,rgbPalette:e.rgbPalette,horizontalFlip:e.horizontalFlip,verticalFlip:e.verticalFlip})}),p={top:t.composedY,left:t.composedX,gridTemplateRows:"repeat(".concat(t.tiles.length,", 16px)"),zIndex:t.spriteMemoryIndex};return a.a.createElement("div",{ref:u,className:Pe.a.root,style:p},s)},Be=function(){var e,t,r,n,a,o,i,c,u,s,l,p,f={},d=-1,m=12,y=5003,h=m,v=1<<m,g=[],w=[],b=y,O=0,E=!1,x=0,_=0,j=[0,1,3,7,15,31,63,127,255,511,1023,2047,4095,8191,16383,32767,65535],I=[],M=f.LZWEncoder=function(a,o,i,c){e=a,t=o,r=i,n=Math.max(2,c)},C=function(e,t){I[p++]=e,p>=254&&F(t)},S=function(e){k(b),O=s+2,E=!0,D(s,e)},k=function(e){for(var t=0;t<e;++t)g[t]=-1},P=f.compress=function(e,t){var r,n,a,o,f,m,y;for(E=!1,c=B(i=u=e),l=(s=1<<e-1)+1,O=s+2,p=0,o=N(),y=0,r=b;r<65536;r*=2)++y;y=8-y,k(m=b),D(s,t);e:for(;(a=N())!=d;)if(r=(a<<h)+o,g[n=a<<y^o]!=r){if(g[n]>=0){f=m-n,0===n&&(f=1);do{if((n-=f)<0&&(n+=m),g[n]==r){o=w[n];continue e}}while(g[n]>=0)}D(o,t),o=a,O<v?(w[n]=O++,g[n]=r):S(t)}else o=w[n];D(o,t),D(l,t)},F=(f.encode=function(r){r.writeByte(n),a=e*t,o=0,P(n+1,r),r.writeByte(0)},function(e){p>0&&(e.writeByte(p),e.writeBytes(I,0,p),p=0)}),B=function(e){return(1<<e)-1},N=function(){return 0===a?d:(--a,255&r[o++])},D=function(e,t){for(x&=j[_],_>0?x|=e<<_:x=e,_+=i;_>=8;)C(255&x,t),x>>=8,_-=8;if((O>c||E)&&(E?(c=B(i=u),E=!1):c=++i==h?v:B(i)),e==l){for(;_>0;)C(255&x,t),x>>=8,_-=8;F(t)}};return M.apply(this,arguments),f},Ne=function(){var e,t,r,n,a,o={},i=256,c=499,u=491,s=487,l=503,p=3*l,f=i-1,d=4,m=100,y=16,h=1<<y,v=10,g=10,w=h>>g,b=h<<v-g,O=i>>3,E=6,x=1<<E,_=O*x,j=30,I=10,M=1<<I,C=8,S=1<<C,k=I+C,P=1<<k,F=[],B=[],N=[],D=[],A=o.NeuQuant=function(e,o,c){var u,s;for(t=e,r=o,n=c,a=new Array(i),u=0;u<i;u++)a[u]=new Array(4),(s=a[u])[0]=s[1]=s[2]=(u<<d+8)/i,N[u]=h/i,B[u]=0},z=function(){for(var e=[],t=new Array(i),r=0;r<i;r++)t[a[r][3]]=r;for(var n=0,o=0;o<i;o++){var c=t[o];e[n++]=a[c][0],e[n++]=a[c][1],e[n++]=a[c][2]}return e},T=function(){var e,t,r,n,o,c,u,s;for(u=0,s=0,e=0;e<i;e++){for(r=e,n=(o=a[e])[1],t=e+1;t<i;t++)(c=a[t])[1]<n&&(r=t,n=c[1]);if(c=a[r],e!=r&&(t=c[0],c[0]=o[0],o[0]=t,t=c[1],c[1]=o[1],o[1]=t,t=c[2],c[2]=o[2],o[2]=t,t=c[3],c[3]=o[3],o[3]=t),n!=u){for(F[u]=s+e>>1,t=u+1;t<n;t++)F[t]=e;u=n,s=e}}for(F[u]=s+f>>1,t=u+1;t<256;t++)F[t]=f},L=function(){var a,o,i,f,y,h,v,g,w,b,O,x,I,C;for(r<p&&(n=1),e=30+(n-1)/3,x=t,I=0,C=r,b=(O=r/(3*n))/m|0,g=M,(v=(h=_)>>E)<=1&&(v=0),a=0;a<v;a++)D[a]=g*((v*v-a*a)*S/(v*v));for(w=r<p?3:r%c!==0?3*c:r%u!==0?3*u:r%s!==0?3*s:3*l,a=0;a<O;)if(i=(255&x[I+0])<<d,f=(255&x[I+1])<<d,y=(255&x[I+2])<<d,o=Y(i,f,y),U(g,o,i,f,y),0!==v&&X(v,o,i,f,y),(I+=w)>=C&&(I-=r),0===b&&(b=1),++a%b===0)for(g-=g/e,(v=(h-=h/j)>>E)<=1&&(v=0),o=0;o<v;o++)D[o]=g*((v*v-o*o)*S/(v*v))},R=(o.map=function(e,t,r){var n,o,c,u,s,l,p;for(s=1e3,p=-1,o=(n=F[t])-1;n<i||o>=0;)n<i&&((c=(l=a[n])[1]-t)>=s?n=i:(n++,c<0&&(c=-c),(u=l[0]-e)<0&&(u=-u),(c+=u)<s&&((u=l[2]-r)<0&&(u=-u),(c+=u)<s&&(s=c,p=l[3])))),o>=0&&((c=t-(l=a[o])[1])>=s?o=-1:(o--,c<0&&(c=-c),(u=l[0]-e)<0&&(u=-u),(c+=u)<s&&((u=l[2]-r)<0&&(u=-u),(c+=u)<s&&(s=c,p=l[3]))));return p},o.process=function(){return L(),R(),T(),z()},function(){var e;for(e=0;e<i;e++)a[e][0]>>=d,a[e][1]>>=d,a[e][2]>>=d,a[e][3]=e}),X=function(e,t,r,n,o){var c,u,s,l,p,f,d;for((s=t-e)<-1&&(s=-1),(l=t+e)>i&&(l=i),c=t+1,u=t-1,f=1;c<l||u>s;){if(p=D[f++],c<l){d=a[c++];try{d[0]-=p*(d[0]-r)/P,d[1]-=p*(d[1]-n)/P,d[2]-=p*(d[2]-o)/P}catch(m){}}if(u>s){d=a[u--];try{d[0]-=p*(d[0]-r)/P,d[1]-=p*(d[1]-n)/P,d[2]-=p*(d[2]-o)/P}catch(m){}}}},U=function(e,t,r,n,o){var i=a[t];i[0]-=e*(i[0]-r)/M,i[1]-=e*(i[1]-n)/M,i[2]-=e*(i[2]-o)/M},Y=function(e,t,r){var n,o,c,u,s,l,p,f,m,h;for(m=f=~(1<<31),p=l=-1,n=0;n<i;n++)(o=(h=a[n])[0]-e)<0&&(o=-o),(c=h[1]-t)<0&&(c=-c),o+=c,(c=h[2]-r)<0&&(c=-c),(o+=c)<f&&(f=o,l=n),(u=o-(B[n]>>y-d))<m&&(m=u,p=n),s=N[n]>>g,N[n]-=s,B[n]+=s<<v;return N[l]+=w,B[l]-=b,p};return A.apply(this,arguments),o},De=function(){for(var e=0,t={};e<256;e++)t[e]=String.fromCharCode(e);function r(){this.bin=[]}r.prototype.getData=function(){for(var e="",r=this.bin.length,n=0;n<r;n++)e+=t[this.bin[n]];return e},r.prototype.writeByte=function(e){this.bin.push(e)},r.prototype.writeUTFBytes=function(e){for(var t=e.length,r=0;r<t;r++)this.writeByte(e.charCodeAt(r))},r.prototype.writeBytes=function(e,t,r){for(var n=r||e.length,a=t||0;a<n;a++)this.writeByte(e[a])};var n,a,o,i,c,u,s,l,p,f={},d=null,m=-1,y=0,h=!1,v=[],g=7,w=-1,b=!1,O=!0,E=!1,x=10,_="Generated by jsgif (https://github.com/antimatter15/jsgif/)",j=(f.setDelay=function(e){y=Math.round(e/10)},f.setDispose=function(e){e>=0&&(w=e)},f.setRepeat=function(e){e>=0&&(m=e)},f.setTransparent=function(e){d=e},f.setComment=function(e){_=e},f.addFrame=function(e,t){if(null===e||!h||null===i)throw new Error("Please call start method before calling addFrame");var r=!0;try{t?e instanceof ImageData?(c=e.data,E&&n==e.width&&a==e.height||I(e.width,e.height)):e instanceof Uint8ClampedArray?e.length==n*a*4?c=e:(console.log("Please set the correct size: ImageData length mismatch"),r=!1):(console.log("Please provide correct input"),r=!1):(c=e.getImageData(0,0,e.canvas.width,e.canvas.height).data,E||I(e.canvas.width,e.canvas.height)),S(),M(),O&&(B(),D(),m>=0&&N()),k(),""!==_&&P(),F(),O||D(),z(),O=!1}catch(o){r=!1}return r},f.download=function(e){if(null===i||0==b)console.log("Please call start method and add frames and call finish method before calling download");else{e=void 0!==e?e.endsWith(".gif")?e:e+".gif":"download.gif";var t=document.createElement("a");t.download=e,t.href=URL.createObjectURL(new Blob([new Uint8Array(i.bin)],{type:"image/gif"})),t.click()}},f.finish=function(){if(!h)return!1;var e=!0;h=!1;try{i.writeByte(59),b=!0}catch(t){e=!1}return e},function(){o=0,c=null,u=null,s=null,p=null,b=!1,O=!0}),I=(f.setFrameRate=function(e){15!=e&&(y=Math.round(100/e))},f.setQuality=function(e){e<1&&(e=1),x=e},f.setSize=function(e,t){h&&!O||((n=e)<1&&(n=320),(a=t)<1&&(a=240),E=!0)}),M=(f.start=function(){j();var e=!0;b=!1,i=new r;try{i.writeUTFBytes("GIF89a")}catch(t){e=!1}return h=e},f.cont=function(){j();return b=!1,i=new r,h=!0},function(){var e=u.length,t=e/3;s=[];var r=new Ne(u,e,x);p=r.process();for(var n=0,a=0;a<t;a++){var i=r.map(255&u[n++],255&u[n++],255&u[n++]);v[i]=!0,s[a]=i}u=null,l=8,g=7,null!==d&&(o=C(d))}),C=function(e){if(null===p)return-1;for(var t=(16711680&e)>>16,r=(65280&e)>>8,n=255&e,a=0,o=16777216,i=p.length,c=0;c<i;){var u=t-(255&p[c++]),s=r-(255&p[c++]),l=n-(255&p[c]),f=u*u+s*s+l*l,d=c/3;v[d]&&f<o&&(o=f,a=d),c++}return a},S=function(){var e=n,t=a;u=[];for(var r=c,o=0,i=0;i<t;i++)for(var s=0;s<e;s++){var l=i*e*4+4*s;u[o++]=r[l],u[o++]=r[l+1],u[o++]=r[l+2]}},k=function(){var e,t;i.writeByte(33),i.writeByte(249),i.writeByte(4),null===d?(e=0,t=0):(e=1,t=2),w>=0&&(t=7&w),t<<=2,i.writeByte(0|t|e),A(y),i.writeByte(o),i.writeByte(0)},P=function(){i.writeByte(33),i.writeByte(254),i.writeByte(_.length),i.writeUTFBytes(_),i.writeByte(0)},F=function(){i.writeByte(44),A(0),A(0),A(n),A(a),O?i.writeByte(0):i.writeByte(128|g)},B=function(){A(n),A(a),i.writeByte(240|g),i.writeByte(0),i.writeByte(0)},N=function(){i.writeByte(33),i.writeByte(255),i.writeByte(11),i.writeUTFBytes("NETSCAPE2.0"),i.writeByte(3),i.writeByte(1),A(m),i.writeByte(0)},D=function(){i.writeBytes(p);for(var e=768-p.length,t=0;t<e;t++)i.writeByte(0)},A=function(e){i.writeByte(255&e),i.writeByte(e>>8&255)},z=function(){new Be(n,a,s,l).encode(i)};f.stream=function(){return i},f.setProperties=function(e,t){h=e,O=t};return f};function Ae(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2?arguments[2]:void 0,n=e.reduce(function(e,t){return e.concat(t.sprites)},[]),a=function(e){var t=Math.max.apply(Math,Object(m.a)(e.map(function(e){return e.composedX})))+16,r=e.reduce(function(e,t){return e.concat(t.tiles)},[]);return{width:t,height:Math.max.apply(Math,Object(m.a)(r.map(function(e){return e.composedY})))+16}}(n),o=document.createElement("canvas");o.width=a.width,o.height=a.height;var i=o.getContext("2d");return Object(m.a)(n).sort(function(e,t){return e.spriteMemoryIndex-t.spriteMemoryIndex}).forEach(function(e){e.tiles.forEach(function(r){var n=document.createElement("canvas"),a=r.tileIndex;3===r.autoAnimation&&(a=(-8&a)+(a+t&7)),2===r.autoAnimation&&(a=(-4&a)+(a+t&3)),me(n,a,r.rgbPalette),(r.horizontalFlip||r.verticalFlip)&&(n=function(e,t){var r=t.horizontalFlip?-1:1,n=t.verticalFlip?-1:1,a=t.horizontalFlip?e.width:0,o=t.verticalFlip?e.height:0,i=document.createElement("canvas");i.width=e.width,i.height=e.height;var c=i.getContext("2d");return c&&(c.save(),c.translate(a,o),c.scale(r,n),c.drawImage(e,0,0),c.restore()),i}(n,r)),i.drawImage(n,e.composedX,r.composedY)})}),r?function(e,t){var r=t[1].x-t[0].x,n=t[1].y-t[0].y,a=document.createElement("canvas");return a.width=r,a.height=n,a.getContext("2d").drawImage(e,t[0].x,t[0].y,r,n,0,0,r,n),a}(o,r):o}var ze=8,Te=0;function Le(e){for(;e.firstChild;)e.removeChild(e.firstChild)}var Re=function(e){var t=e.isOpen,r=e.onRequestClose,o=H(),c=Object(f.a)(o,1)[0],u=Object(n.useRef)(null),s=Object(n.useState)(null),l=Object(f.a)(s,2),p=l[0],d=l[1];return Object(n.useEffect)(function(){if(t){var e=16*window.Module._get_neogeo_frame_counter_speed();!function(e,t,r,n,a){var o=new De;o.setRepeat(Te),o.setDelay(r),o.setQuality(1),o.start();var i=ze,c=function(){o.finish();var e=o.stream().getData();a("data:image/gif;base64,".concat(btoa(e)))};!function r(){var a=ze-i,u=Ae(e,a,t);o.addFrame(u.getContext("2d")),--i,n(u,a,ze),i?setTimeout(r,1):setTimeout(c,1)}()}(c.layers.reduce(function(e,t){return e.concat(t.groups)},[]),c.crop,e,function(e,t,r){d({frame:t,totalFrames:r}),u&&u.current&&(Le(u.current),u.current.appendChild(e))},function(e){if(d(null),u&&u.current){Le(u.current);var t=new Image;t.src=e,u.current.appendChild(t)}})}},[t]),a.a.createElement(i.a,{isOpen:t,onRequestClose:r},p&&a.a.createElement("div",null,p.frame," of ",p.totalFrames),a.a.createElement("div",{ref:u}))},Xe=r(14),Ue=r.n(Xe),Ye=function(e){var t=e.group,r=e.onDelete,n=e.onToggleVisibility;return a.a.createElement("div",{className:Ue.a.group},t.sprites[0].spriteMemoryIndex," ",a.a.createElement("button",{onClick:function(){return r()}},"delete"),a.a.createElement("button",{onClick:function(){return n()}},t.hidden?"show":"hide"))},He=function(e){var t=e.layer,r=e.onDelete,n=e.onToggleVisibility,o=e.onGroupDelete,i=e.onGroupToggleVisibility,c=e.onClick,u=e.onExtendViaMirror,s=e.focused,l=t.groups.map(function(e,t){return a.a.createElement(Ye,{key:t,group:e,onDelete:function(){return o(e)},onToggleVisibility:function(){return i(e)}})}),p=ee()(Ue.a.layer,Object(d.a)({},Ue.a.focused,s));return a.a.createElement("div",{className:p,onClick:function(){return c()}},a.a.createElement("div",null,"layer",a.a.createElement("button",{onClick:function(){return r()}},"delete"),a.a.createElement("button",{onClick:function(){return n()}},t.hidden?"show":"hide"),a.a.createElement("button",{disabled:t.extendedViaMirror,onClick:function(){return u()}},"extend via mirror")),l)},Ve=function(e){var t=e.className,r=H(),n=Object(f.a)(r,2),o=n[0],i=n[1],c=ee()(Ue.a.root,t),u=o.layers.map(function(e,t){return a.a.createElement(He,{key:t,layer:e,focused:t===o.focusedLayerIndex,onClick:function(){return i(function(e){return{type:"SetFocusedLayer",layer:e}}(e))},onDelete:function(){return i(function(e){return{type:"DeleteLayer",layer:e}}(e))},onToggleVisibility:function(){return i(function(e){return{type:"ToggleVisibilityOfLayer",layer:e}}(e))},onGroupDelete:function(e){return i(function(e){return{type:"DeleteGroup",group:e}}(e))},onGroupToggleVisibility:function(e){return i(function(e){return{type:"ToggleVisibilityOfGroup",group:e}}(e))},onExtendViaMirror:function(){return i(function(e){return{type:"ExtendLayerViaMirror",layer:e}}(e))}})});return a.a.createElement("div",{className:c},a.a.createElement("button",{onClick:function(){return i(q)}},"new layer"),u)},Ge=r(12),Ze=r.n(Ge),qe=function(e){var t=e.className,r=e.crop,n=e.totalWidth,o=e.totalHeight,i=ee()(Ze.a.root,t),c={height:r[0].y,gridColumn:"1 / -1",gridRow:"1"},u={width:r[0].x,height:r[1].y-r[0].y,gridColumn:"1",gridRow:"2"},s={gridColumn:"3",gridRow:"2",width:n-r[1].x},l={width:r[1].x-r[0].x,height:r[1].y-r[0].y,gridColumn:"2",gridRow:"2"},p={gridColumn:"1 / -1",gridRow:"3",flex:"1",height:o-r[1].y};return a.a.createElement("div",{className:i},a.a.createElement("div",{className:Ze.a.mask,style:c}),a.a.createElement("div",{className:Ze.a.mask,style:u}),a.a.createElement("div",{className:Ze.a.crop,style:l}),a.a.createElement("div",{className:Ze.a.mask,style:s}),a.a.createElement("div",{className:Ze.a.mask,style:p}))},Qe=r(8),We=r.n(Qe),Ke=function(e){var t=e.className,r=Object(n.useState)({animation:0,rafFrameCountdown:0}),o=Object(f.a)(r,2),i=o[0],c=o[1],u=Object(n.useState)(!1),s=Object(f.a)(u,2),p=s[0],d=s[1],y=Object(n.useState)(!1),h=Object(f.a)(y,2),v=h[0],g=h[1],w=H(),b=Object(f.a)(w,2),O=b[0],E=b[1],x=Object(n.useState)(null),_=Object(f.a)(x,2),j=_[0],I=_[1],M=Object(n.useState)(!1),S=Object(f.a)(M,2),k=S[0],P=S[1],F=Object(n.useState)(null),B=Object(f.a)(F,2),N=B[0],D=B[1],A=Object(n.useState)(null),z=Object(f.a)(A,2),T=z[0],L=z[1];Object(n.useEffect)(function(){if(p){var e=window.Module._get_neogeo_frame_counter_speed()-1;requestAnimationFrame(function(){var t=0===i.rafFrameCountdown?1:0;c({animation:i.animation+t,rafFrameCountdown:1===t?e:i.rafFrameCountdown-1})})}});var R=Object(l.d)({accept:"Sprite",drop:function(e,t){if(j){var r=t.getClientOffset().x-j.getBoundingClientRect().left,n=16*Math.floor(r/16),a=e.spriteIndex,o=e.pauseId;E(function(e,t,r){return{type:"ExtractSprite",spriteMemoryIndex:e,composedX:t,pauseId:r}}(a,n,o))}},canDrop:function(){return!k}}),X=Object(f.a)(R,2),U=(X[0],X[1]),Y=O.layers.reduce(function(e,t){if(t.hidden)return e;var r=t.groups.reduce(function(e,t){return t.hidden?e:e.concat(t.sprites)},[]);return e.concat(r)},[]),V=Y.map(function(e){return a.a.createElement(Fe,{key:e.spriteMemoryIndex,data:e,autoAnimate:p,animationCounter:i.animation,canDrag:!k})}),G=O.isPaused?function(e){var t=C(e);return"rgb(".concat(t[0],", ").concat(t[1],", ").concat(t[2],")")}(function(){var e=window.Module._get_current_pal_addr();return e+=8190,e/=2,window.Module.HEAPU16[e]}()):"transparent",q=Math.max.apply(Math,Object(m.a)(Y.map(function(e){return e.composedX}))),W=Math.max(q+48,320),K=Math.max.apply(Math,Object(m.a)(Y.map(function(e){return Math.max.apply(Math,Object(m.a)(e.tiles.map(function(e){return e.composedY})))}))),J=Math.max(K+48,240),$={backgroundColor:G,width:W,height:J},te=ee()(We.a.root,t);return a.a.createElement(a.a.Fragment,null,a.a.createElement(Re,{isOpen:v,onRequestClose:function(){return g(!1)}}),a.a.createElement("div",{className:te},a.a.createElement("div",{className:We.a.toolbar},a.a.createElement("button",{disabled:k,onClick:function(){P(!0),E(Q),D(null),L(null)}},"crop"),a.a.createElement("button",{disabled:!O.crop,onClick:function(){E(Q),D(null),L(null)}},"clear crop"),a.a.createElement("button",{onClick:function(){return d(!p)}},p?"stop":"preview"),a.a.createElement("button",{onClick:function(){return g(!0)}},"build gif"),a.a.createElement("div",null,i.animation," (",i.rafFrameCountdown,")")),a.a.createElement(Ve,{className:We.a.layers}),a.a.createElement("div",{className:We.a.bg,ref:function(e){I(e),U(e)},style:$},k&&a.a.createElement("div",{className:We.a.captureLayer,onMouseDown:function(e){if(k){var t=e.target.getBoundingClientRect(),r=e.clientX-t.x,n=e.clientY-t.y,a=16*Math.floor(r/16),o=16*Math.floor(n/16);D({x:a,y:o})}},onMouseMove:function(e){if(k&&N){var t=e.target.getBoundingClientRect(),r=e.clientX-t.x,n=e.clientY-t.y,a=16*Math.floor(r/16),o=16*Math.floor(n/16);L({x:a,y:o})}},onMouseUp:function(e){k&&N&&T&&(E({type:"SetCrop",crop:[N,T]}),P(!1))}}),V,!!(k&&N&&T||O.crop)&&a.a.createElement(qe,{className:We.a.cropRect,crop:O.crop||[N,T],totalWidth:W,totalHeight:J})),a.a.createElement("button",{className:We.a.handleNegatives,onClick:function(){return E(Z)}},"handle negatives")))};r(68);i.a.setAppElement("#root"),u.a.render(a.a.createElement(function(){return a.a.createElement(Y,null,a.a.createElement(l.b,{backend:p.a},a.a.createElement(s.d,null,a.a.createElement(s.c,{size:"50%"},a.a.createElement(s.b,{size:"30%"},a.a.createElement(ie,null)),a.a.createElement(s.a,null,a.a.createElement(Ke,null))),a.a.createElement(s.a,null,a.a.createElement(Ie,null)))))},null),document.getElementById("root"))},8:function(e,t,r){e.exports={root:"composeScreen_root__3bwon",layers:"composeScreen_layers__ioZ1g",toolbar:"composeScreen_toolbar__1QlS0",bg:"composeScreen_bg__1xmrl",captureLayer:"composeScreen_captureLayer__1AfVW",cropRect:"composeScreen_cropRect__3Yoa2",handleNegatives:"composeScreen_handleNegatives__3RkzZ"}}},[[46,1,2]]]);
//# sourceMappingURL=main.c0a3367d.chunk.js.map